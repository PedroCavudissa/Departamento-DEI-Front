<div class="container">
  <app-barralateral></app-barralateral>
  <h1 class="titulo-pagina">Gerenciamento de Comunicados</h1>

  <!-- Formulário -->
  <mat-card class="card-form">
    <mat-card-header>
      <mat-card-title>{{ modoEdicao ? 'Editar' : 'Novo' }} Comunicado</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form (submit)="salvar()" class="form-container">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Título *</mat-label>
          <input matInput [(ngModel)]="comunicadoEmEdicao.titulo" name="titulo" required>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Conteúdo *</mat-label>
          <textarea matInput [(ngModel)]="comunicadoEmEdicao.conteudo" name="conteudo" rows="5" required></textarea>
        </mat-form-field>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Status</mat-label>
            <mat-select [(ngModel)]="comunicadoEmEdicao.noticeStatus" name="noticeStatus">
              <mat-option value="VALIDO">Válido</mat-option>
              <mat-option value="INVALIDO">Inválido</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Destinatário</mat-label>
            <mat-select [(ngModel)]="comunicadoEmEdicao.destinado" name="destinado">
              <mat-option value="PROFESSOR">Professor</mat-option>
              <mat-option value="ALUNO">Aluno</mat-option>
              <mat-option value="TODOS">Todos</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Data do Acontecimento</mat-label>
          <input matInput type="date" [(ngModel)]="comunicadoEmEdicao.dataAcontecimento" name="dataAcontecimento">
        </mat-form-field>

        <div class="form-actions">
          <button mat-raised-button color="warn" type="button"
                  (click)="limparFormulario()" *ngIf="modoEdicao">
            Cancelar
          </button>
          <button mat-raised-button color="primary" type="submit" [disabled]="carregando">
            <span *ngIf="!carregando">{{ modoEdicao ? 'Atualizar' : 'Salvar' }}</span>
            <mat-spinner diameter="20" *ngIf="carregando"></mat-spinner>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- LISTA DE COMUNICADOS COM ESTILIZAÇÃO EM CARD -->
  <mat-card>
    <mat-card-header>
      <mat-card-title>Comunicados Cadastrados</mat-card-title>
      <mat-spinner diameter="30" *ngIf="carregando"></mat-spinner>
    </mat-card-header>

    <mat-card-content>
      <ng-container *ngIf="(comunicados?.length ?? 0) > 0; else noComunicados">
        <section *ngFor="let comunicado of comunicados" class="comunicado-card">
          <div class="comunicado-header">
            <h2>{{ comunicado.titulo }}</h2>
            <span class="status-badge" [ngClass]="getStatusClass(comunicado.noticeStatus)">
              {{ comunicado.noticeStatus | lowercase }}
            </span>
          </div>

          <div class="comunicado-meta">
            <p><strong>Autor:</strong> {{ comunicado.nomeFuncionario }}</p>
            <p><strong>Destinatário:</strong> {{ comunicado.destinado | titlecase }}</p>
          </div>

          <div class="comunicado-content">
            <h3>Conteúdo:</h3>
            <p>{{ comunicado.conteudo }}</p>
          </div>

          <div class="comunicado-footer">
            <p>
              <strong>Publicado em:</strong>
              <time [attr.datetime]="comunicado.dataPublicacao">
                {{ comunicado.dataPublicacao | date: 'dd/MM/yyyy HH:mm' }}
              </time>
            </p>
            <p *ngIf="comunicado.dataAcontecimento">
              <strong>Data do acontecimento:</strong>
              {{ comunicado.dataAcontecimento | date: 'dd/MM/yyyy' }}
            </p>
          </div>

          <div class="form-actions" style="margin-top: 10px;">
            <button mat-raised-button color="primary" (click)="editar(comunicado)">
              <mat-icon>edit</mat-icon> Editar
            </button>
            <button mat-raised-button color="warn" (click)="excluir(comunicado.id)">
              <mat-icon>delete</mat-icon> Excluir
            </button>
          </div>
        </section>
      </ng-container>

      <ng-template #noComunicados>
        <div class="empty-state">
          <p>Nenhum comunicado cadastrado.</p>
        </div>
      </ng-template>
    </mat-card-content>
  </mat-card>
</div>
